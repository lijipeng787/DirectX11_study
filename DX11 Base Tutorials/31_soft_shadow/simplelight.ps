Texture2D shaderTexture;
SamplerState SampleType;

cbuffer LightBuffer {
	float4 ambientColor;
	float4 diffuseColor;
	float3 lightDirection;
	float padding;
};

struct PixelInputType{
    float4 position : SV_POSITION;
    float2 tex : TEXCOORD0;
	float3 normal : NORMAL;
};

float4 SimpleLightPixelShader(PixelInputType input) : SV_TARGET{

	float4 textureColor;
	float3 normal;
	float3 lightDir;
	float lightIntensity;
	float4 color;

	// 采样纹理颜色
	textureColor = shaderTexture.Sample(SampleType, input.tex);
	
	// 重新归一化法线（光栅化插值后可能不再是单位向量）
	// 这对于准确的点积计算很重要，确保光照计算的正确性
	normal = normalize(input.normal);
	
	// 初始化颜色为环境光
	color = ambientColor;
	
	// 计算光照方向（取反，因为方向光方向指向光源）
	// 归一化光照方向以确保正确性（即使输入可能已经是单位向量）
	lightDir = normalize(-lightDirection);
	
	// 计算漫反射光照强度，使用 saturate 限制在 [0, 1] 范围内
	// saturate 会自动处理负值（背光面），无需 if 分支，提升性能
	lightIntensity = saturate(dot(normal, lightDir));
	
	// 添加漫反射光照贡献
	color += (diffuseColor * lightIntensity);
	
	// 限制最终颜色在有效范围内
	color = saturate(color);
	
	// 将光照结果与纹理颜色相乘
	color = color * textureColor;
	
	return color;
}

